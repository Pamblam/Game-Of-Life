/*! go-life - v2.0.94 */
class GoL{constructor(e,t){t=t||{},this.renderer=e,this.speed=+t.speed||500,this.ruleString=t.ruleString||"B3/S23",this.rule={b:[3],s:[2,3]},this.grid=[],this.running=!1,this.liveCells={},this.parseRuleString().generateGrid().render()}render(){var e=Object.values(this.liveCells);this.renderer.render(e)}loadPatternFile(e){var t,r;this.running&&this.stop(),this.generateGrid(),t=Math.floor(this.grid.length/2)-Math.floor(e.height/2),r={x:Math.floor(this.grid[0].length/2)-Math.floor(e.width/2)+e.relativePos.x,y:t+e.relativePos.y};for(var i=0;i<e.rows.length;i++)for(var s=0;s<e.rows[i].length;s++)1==e.rows[i][s]&&this.grid[r.y+i]&&this.grid[r.y+i][r.x+s]&&this.toggleCell(this.grid[r.y+i][r.x+s]);return e.ruleStr&&this.parseRuleString(e.ruleStr),this.render(),this}parseRuleString(e){e=e||this.ruleString,this.ruleString=e;var t,r=[],i=[];return r=((t="B"===(e=e.toUpperCase().split("/").map(e=>e.trim()))[0][0])?e[0]:e[1]).match(/\d/g)||[],i=(t?e[1]:e[0]).match(/\d/g)||[],this.rule={b:r.map(e=>parseInt(e)),s:i.map(e=>parseInt(e))},this}toggleCell(e){return e.alive=!e.alive,e.alive?this.liveCells[e.name]=e:delete this.liveCells[e.name],this}start(){const e=()=>{this.tick().render(),this.running&&setTimeout(()=>e(),this.speed)};return this.running||(this.running=!0,e()),this}stop(){return this.running=!1,this}generateGrid(){this.grid=[],this.liveCells={};for(let e=0;e<this.renderer.rows;e++){let e=[];for(let t=0;t<this.renderer.columns;t++)e.push(new GoLCell(this.grid.length,e.length));this.grid.push(e)}return this}iterateAllCells(e){for(let t=this.grid.length;t--;)for(let r=this.grid[t].length;r--;)if(!1===e(this.grid[t][r]))return this;return this}getNeighbors(e){var t=[];return this.grid[e.row-1]&&(this.grid[e.row-1][e.col-1]&&t.push(this.grid[e.row-1][e.col-1]),this.grid[e.row-1][e.col]&&t.push(this.grid[e.row-1][e.col]),this.grid[e.row-1][e.col+1]&&t.push(this.grid[e.row-1][e.col+1])),this.grid[e.row+1]&&(this.grid[e.row+1][e.col-1]&&t.push(this.grid[e.row+1][e.col-1]),this.grid[e.row+1][e.col]&&t.push(this.grid[e.row+1][e.col]),this.grid[e.row+1][e.col+1]&&t.push(this.grid[e.row+1][e.col+1])),this.grid[e.row][e.col-1]&&t.push(this.grid[e.row][e.col-1]),this.grid[e.row][e.col+1]&&t.push(this.grid[e.row][e.col+1]),t}mutateCell(e){var t=!1,r=this.getNeighbors(e),i=0;for(let e=r.length;e--;)r[e].alive&&i++;return e.alive?~this.rule.s.indexOf(i)||(t=!0):~this.rule.b.indexOf(i)&&(t=!0),t}getRelevantCells(){var e,t=Object.values(this.liveCells),r={};for(let i=t.length;i--;){r[t[i].name]=t[i];for(let s=(e=this.getNeighbors(t[i])).length;s--;)r[e[s].name]=e[s]}return Object.values(r)}tick(){var e=this.getRelevantCells(),t=[];this.rescanCells={};for(let r=e.length;r--;)this.mutateCell(e[r])&&t.push(e[r]);for(let e=t.length;e--;)this.toggleCell(t[e]);return this}}class GoLCell{constructor(e,t){this.alive=!1,this.name=`${e},${t}`,this.row=e,this.col=t}}class GoLMouse{constructor(e){this.game=e,this.enabled=!1,this.mouseDown=!1,this.mouseDownOverCellName="",this.mouseHoverOverCellName="",this.createListeners()}enable(){return this.enabled=!0,this}disable(){return this.enabled=!1,this}getCellAt(e,t){var r=Math.floor(e/this.game.renderer.boxSize),i=Math.floor(t/this.game.renderer.boxSize);return this.game.grid[i][r]}createListeners(){return document.addEventListener("mousedown",e=>{e.target===this.game.renderer.ele&&(0==e.button&&(this.mouseDown=!0),this.handleActiveMouse(e))}),document.addEventListener("mouseup",e=>{0==e.button&&(this.mouseDown=!1),this.mouseDownOverCellName=""}),this.game.renderer.ele.addEventListener("mousemove",e=>{this.handleActiveMouse(e)}),this}handleMouseDown(e){return e.name===this.mouseDownOverCellName?this:(this.mouseDownOverCellName=e.name,this.game.toggleCell(e),this.game.renderer.renderCell(e),this)}handleMouseOver(e){if(this.mouseHoverOverCellName!=e.name){this.mouseHoverOverCellName=e.name;var t=new Event("cellhover");t.cell=e,this.game.renderer.ele.dispatchEvent(t)}return this}handleActiveMouse(e){if(!this.enabled)return this;var t=e.clientX-this.game.renderer.ele.offsetLeft,r=e.clientY-this.game.renderer.ele.offsetTop,i=(t=t*this.game.renderer.ele.width/this.game.renderer.ele.clientWidth,r=r*this.game.renderer.ele.height/this.game.renderer.ele.clientHeight,this.getCellAt(t,r));return this.mouseDown?this.handleMouseDown(i):(this.handleMouseOver(i),this)}}class GoLPatternFile{constructor(e){e||(e={}),this.name=e.name||"",this.comments=e.comments||[],this.author=e.author||"",this.relativePos=e.relativePos||{x:0,y:0},this.ruleStr=e.ruleStr||"B3/S23",this.width=e.width||0,this.height=e.height||0,this.rows=e.rows||[]}}class GoLRLE extends GoLPatternFile{constructor(e){super(e)}fromRawData(e){return this.parseName(e).parseComments(e).parseAuthor(e).parsePosition(e).parseRuleFromHeader(e).parseHeaderLine(e).parseCellData(e)}parsePosition(e){var t=(e.match(/^#R.*/gm)||[""])[0];return t?((t=t.match(/-?\d*/g).filter(e=>!!e))[0]&&(this.relativePos.x=parseInt(t[0])),t[1]&&(this.relativePos.y=parseInt(t[1])),this):this}parseRuleFromHeader(e){var t=(e.match(/^#r.*/gm)||[""])[0];return t&&(t=t.substr(2).trim()),this.ruleStr=t,this}parseName(e){var t=(e.match(/^#N.*/gm)||[""])[0];return t&&(t=t.substr(2).trim()),this.name=t,this}parseAuthor(e){var t=(e.match(/^#O.*/gm)||[""])[0];return t&&(t=t.substr(2).trim()),this.author=t,this}parseComments(e){var t=e.match(/^#C.*|^#c.*/gm)||[];return t=t.map(e=>e.substr(2).trim()),this.comments=t,this}parseHeaderLine(e){var t=e.toLowerCase();return(t=((t=t.match(/x\s?=\s?\d*\s?,\s?y\s?=\s?\d*.*/gm))||[""])[0])?(t.split(",").map(e=>e.trim()).forEach(e=>{var t=e.split("=")[1].trim();"x"===e.substr(0,1)?this.width=parseInt(t):"y"===e.substr(0,1)?this.height=parseInt(t):"r"===e.substr(0,1)&&(this.ruleStr=t)}),this):this}parseCellData(e){var t=[],r=[];return((e.match(/^[\dbo\$]*!?$/gm)||[]).filter(e=>!!e).join("").match(/\d*b|\d*o|\d*\$/gm)||[]).forEach(e=>{for(var i=e.substr(-1),s=parseInt((e.match(/\d*/g)||[]).filter(e=>!!e)[0]||1);s--;)"$"==i?(t.push(r),r=[]):r.push("o"==i?1:0)}),r.length&&t.push(r),this.rows=t,this}}class GoLRenderer{constructor(e){e||(e={}),this.boxSize=+e.boxSize||10,this.gridColor=e.gridColor||"#BFBFBF",this.aliveColor=e.aliveColor||"#000000",this.deadColor=e.deadColor||"#FFFFFF",this.ele=null,this.renderingArea=null,this.columns=0,this.rows=0}render(e){return this}renderCell(e){return this}setRenderingArea(e){return this.renderingArea=e,this}}class GoLCanvasRenderer extends GoLRenderer{constructor(e,t){super(t),this.ele=e,this.ctx=e.getContext("2d"),this.columns=Math.floor(this.ele.width/this.boxSize),this.rows=Math.floor(this.ele.height/this.boxSize),this.renderingArea=new DOMRect(0,0,this.ele.width,this.ele.height),this.renderTimeout=!1}setRenderingArea(e){return this.renderingArea=e,this}renderGridLines(){this.ctx.lineWidth=1,this.ctx.strokeStyle=this.gridColor;for(var e=Math.ceil(this.renderingArea.x/this.boxSize);e*this.boxSize<=this.renderingArea.right;)this.ctx.beginPath(),this.ctx.moveTo(e*this.boxSize,this.renderingArea.top),this.ctx.lineTo(e*this.boxSize,this.renderingArea.bottom),this.ctx.stroke(),e++;for(var t=Math.ceil(this.renderingArea.y/this.boxSize);t*this.boxSize<=this.renderingArea.bottom;)this.ctx.beginPath(),this.ctx.moveTo(this.renderingArea.left,t*this.boxSize),this.ctx.lineTo(this.renderingArea.right,t*this.boxSize),this.ctx.stroke(),t++;return this}isInBounds(e){return e.col*this.boxSize>=this.renderingArea.left&&e.col*this.boxSize<=this.renderingArea.right&&e.row*this.boxSize>=this.renderingArea.top&&e.row*this.boxSize<=this.renderingArea.bottom}render(e){this.ctx.fillStyle=this.deadColor,this.ctx.fillRect(this.renderingArea.x,this.renderingArea.y,this.renderingArea.width,this.renderingArea.height);for(var t=e.length;t--;)this.isInBounds(e[t])&&this.renderCell(e[t]);return this.renderGridLines(),this}renderCell(e){return this.ctx.fillStyle=e.alive?this.aliveColor:this.deadColor,this.ctx.fillRect(e.col*this.boxSize+.5,e.row*this.boxSize+.5,this.boxSize-1,this.boxSize-1),this}}