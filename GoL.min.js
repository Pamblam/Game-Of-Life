/*! go-life - v2.0.210 */
class GoL{constructor(e,t){t=t||{},this.renderer=e,this.speed=+t.speed||500,this.ruleString=t.ruleString||"B3/S23",this.rule={b:[3],s:[2,3]},this.grid=[],this.running=!1,this.liveCells={},this.parseRuleString().generateGrid().render()}getRule(){return`B${this.rule.b.join("")}/S${this.rule.s.join("")}`}render(){var e=Object.values(this.liveCells);this.renderer.render(e)}loadPatternFile(e){var t,r;this.running&&this.stop(),this.generateGrid(),t=Math.floor(this.grid.length/2)-Math.floor(e.height/2),r={x:Math.floor(this.grid[0].length/2)-Math.floor(e.width/2)+e.relativePos.x,y:t+e.relativePos.y};for(var i=0;i<e.rows.length;i++)for(var s=0;s<e.rows[i].length;s++)1==e.rows[i][s]&&this.grid[r.y+i]&&this.grid[r.y+i][r.x+s]&&this.toggleCell(this.grid[r.y+i][r.x+s]);return e.ruleStr&&this.parseRuleString(e.ruleStr),this.render(),this}parseRuleString(e){e=e||this.ruleString,this.ruleString=e;var t,r=[],i=[];return r=((t="B"===(e=e.toUpperCase().split("/").map(e=>e.trim()))[0][0])?e[0]:e[1]).match(/\d/g)||[],i=(t?e[1]:e[0]).match(/\d/g)||[],this.rule={b:r.map(e=>parseInt(e)),s:i.map(e=>parseInt(e))},this}toggleCell(e){return e.alive=!e.alive,e.alive?this.liveCells[e.name]=e:delete this.liveCells[e.name],this}start(){const e=()=>{this.tick().render(),this.running&&setTimeout(()=>e(),this.speed)};return this.running||(this.running=!0,e()),this}stop(){return this.running=!1,this}generateGrid(){this.grid=[],this.liveCells={};for(let e=0;e<this.renderer.rows;e++){let e=[];for(let t=0;t<this.renderer.columns;t++)e.push(new GoLCell(this.grid.length,e.length));this.grid.push(e)}return this}serialize(){var e,t,r,i=[];for(e=0;e<this.grid.length;e++){for(r=[],t=0;t<this.grid[e].length;t++)r.push(this.grid[e][t].alive?1:0);i.push(r)}return i}getNeighbors(e){var t=[];return this.grid[e.row-1]&&(this.grid[e.row-1][e.col-1]&&t.push(this.grid[e.row-1][e.col-1]),this.grid[e.row-1][e.col]&&t.push(this.grid[e.row-1][e.col]),this.grid[e.row-1][e.col+1]&&t.push(this.grid[e.row-1][e.col+1])),this.grid[e.row+1]&&(this.grid[e.row+1][e.col-1]&&t.push(this.grid[e.row+1][e.col-1]),this.grid[e.row+1][e.col]&&t.push(this.grid[e.row+1][e.col]),this.grid[e.row+1][e.col+1]&&t.push(this.grid[e.row+1][e.col+1])),this.grid[e.row][e.col-1]&&t.push(this.grid[e.row][e.col-1]),this.grid[e.row][e.col+1]&&t.push(this.grid[e.row][e.col+1]),t}mutateCell(e){var t=!1,r=this.getNeighbors(e),i=0;for(let e=r.length;e--;)r[e].alive&&i++;return e.alive?~this.rule.s.indexOf(i)||(t=!0):~this.rule.b.indexOf(i)&&(t=!0),t}getRelevantCells(){var e,t=Object.values(this.liveCells),r={};for(let i=t.length;i--;){r[t[i].name]=t[i];for(let s=(e=this.getNeighbors(t[i])).length;s--;)r[e[s].name]=e[s]}return Object.values(r)}tick(){var e=this.getRelevantCells(),t=[];this.rescanCells={};for(let r=e.length;r--;)this.mutateCell(e[r])&&t.push(e[r]);for(let e=t.length;e--;)this.toggleCell(t[e]);return this}}class GoLCell{constructor(e,t){this.alive=!1,this.name=`${e},${t}`,this.row=e,this.col=t}}class GoLMouse{constructor(e){this.game=e,this.enabled=!1,this.mouseDown=!1,this.mouseDownOverCellName="",this.mouseHoverOverCellName="",this.mode="click",this.initialpos=!1,this.mouseupHandler=this._mouseUp.bind(this),this.mousedownHandler=this._mouseDown.bind(this),this.mouseMoveHandler=this._mouseMove.bind(this),this.setListeners(!1)}enable(){return this.enabled=!0,this}disable(){return this.enabled=!1,this}getTargetEle(){return document.getElementById("canvas_widsheild")||this.game.renderer.ele}getCellAt(e,t){var r=Math.floor(e/this.game.renderer.boxSize),i=Math.floor(t/this.game.renderer.boxSize);return this.game.grid[i][r]}_mouseDown(e){e.target===this.getTargetEle()&&(e.preventDefault(),e.stopPropagation(),0==e.button&&(this.mouseDown=!0),this.handleActiveMouse(e))}_mouseUp(e){this.initialpos=!1,0==e.button&&(this.mouseDown=!1),this.mouseDownOverCellName=""}_mouseMove(e){this.handleActiveMouse(e)}setListeners(e=!0){return e&&(document.removeEventListener("mousedown",this.mousedownHandler),document.removeEventListener("mouseup",this.mouseupHandler),this.getTargetEle().removeEventListener("mousemove",this.mouseMoveHandler,!0)),document.addEventListener("mousedown",this.mousedownHandler),document.addEventListener("mouseup",this.mouseupHandler),this.getTargetEle().addEventListener("mousemove",this.mouseMoveHandler,!0),this}handleMouseDown(e){return e.name===this.mouseDownOverCellName?this:(this.mouseDownOverCellName=e.name,this.game.toggleCell(e),this.game.renderer.renderCell(e),this)}handleMouseDrag(e,t){!1===this.initialpos&&(this.initialpos={x:e,y:t});var r={start:{x:this.initialpos.x,y:this.initialpos.y},end:{x:e,y:t}},i=new Event("dragboard");return i.movement=r,this.game.renderer.ele.dispatchEvent(i),this}handleMouseOver(e){if(this.mouseHoverOverCellName!=e.name){this.mouseHoverOverCellName=e.name;var t=new Event("cellhover");t.cell=e,this.game.renderer.ele.dispatchEvent(t)}return this}getRelativeMousePos(e){var t=this.game.renderer.ele.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top;return{x:r=r*parseInt(this.game.renderer.ele.getAttribute("width"))/t.width,y:i=i*parseInt(this.game.renderer.ele.getAttribute("height"))/t.height}}handleActiveMouse(e){if(!this.enabled)return this;if(!this.mouseDown){t=this.getRelativeMousePos(e),r=this.getCellAt(t.x,t.y);return this.handleMouseOver(r)}if("click"==this.mode){var t=this.getRelativeMousePos(e),r=this.getCellAt(t.x,t.y);return this.handleMouseDown(r)}return"drag"==this.mode?this.handleMouseDrag(e.layerX,e.layerY):void 0}}class GoLPatternFile{constructor(e){e||(e={}),this.name=e.name||"",this.comments=e.comments||[],this.author=e.author||"",this.relativePos=e.relativePos||{x:0,y:0},this.ruleStr=e.ruleStr||"B3/S23",this.width=e.width||0,this.height=e.height||0,this.rows=e.rows||[],this.raw=e.raw||""}encode(e){return this.rows=e&&e.length?e:this.rows,this}decode(e){return this.raw=e||this.raw,this}}class GoLRLE extends GoLPatternFile{constructor(e){super(e)}encode(e){super.encode(e);var t=[];return this.generateOffsets(),t.push(...this.generateName()),t.push(...this.generateComments()),t.push(...this.generateAuthor()),t.push(...this.generatePosition()),t.push(...this.generateHeaderLine()),t.push(...this.generateRowLines()),this.raw=t.join("\n"),this}decode(e){return super.decode(e),this.parseName().parseComments().parseAuthor().parsePosition().parseRuleFromHeader().parseHeaderLine().parseCellData()}generateRowLines(){var e,t,r,i,s=0,h=!1,n=[],o=0;for(e=0;e<this.rows.length;e++){for(r=this.rows[e],t=0;t<r.length;t++)i=1==r[t]?"o":"b",!1===h?(h=i,s=1):h===i?s++:(o&&(o>1&&n.push(o),n.push("$"),o=0),s>1&&n.push(s),n.push(h),h=i,s=1);"o"===h&&(s>1&&n.push(s),n.push(h)),h=!1,s=0,o++}return"o"===h&&(o&&(o>1&&n.push(o),n.push("$")),s>1&&n.push(s),n.push(h)),n.push("!"),this.stringChunker(n.join(""))}generateHeaderLine(){return[`x = ${this.rows[0].length}, y = ${this.rows.length}, rule = ${this.ruleStr}`]}generatePosition(){return 0==this.relativePos.x&&0==this.relativePos.y?[]:[`#P ${this.relativePos.x} ${this.relativePos.y}`]}generateComments(){for(var e=this.stringChunker(this.comments,67),t=[],r=0;r<e.length;r++)e[r].trim()&&t.push("#C "+e[r].trim());return t}generateAuthor(){for(var e=this.stringChunker(this.author,67),t=[],r=0;r<e.length;r++)e[r].trim()&&t.push("#O "+e[r].trim());return t}generateName(){for(var e=this.stringChunker(this.name,67),t=[],r=0;r<e.length;r++)e[r].trim()&&t.push("#N "+e[r].trim());return t}generateOffsets(){var e,t,r,i,s,h=!1,n=!1,o=0,l=0,a=[],u=[];for(e=0;e<this.rows.length;e++){for(i=this.rows[e],r=!1,t=0;t<i.length;t++)1==(s=i[t])&&(r=!0,(!1===n||t<n)&&(n=t),t>l&&(l=t));r&&!1===h&&(h=e),r&&e>o&&(o=e)}for(h=h||0,n=n||0,this.relativePos={x:n,y:h},e=h;e<o+1;e++){for(i=this.rows[e]||[],u=[],t=n;t<l+1;t++)s=i[t]||0,u.push(s);a.push(u)}return this.rows=a,this}parsePosition(){var e=(this.raw.match(/^#R.*/gm)||[""])[0];return e?((e=e.match(/-?\d*/g).filter(e=>!!e))[0]&&(this.relativePos.x=parseInt(e[0])),e[1]&&(this.relativePos.y=parseInt(e[1])),this):this}parseRuleFromHeader(){var e=(this.raw.match(/^#r.*/gm)||[""])[0];return e&&(e=e.substr(2).trim()),this.ruleStr=e,this}parseName(){var e=(this.raw.match(/^#N.*/gm)||[""])[0];return e&&(e=e.substr(2).trim()),this.name=e,this}parseAuthor(){var e=(this.raw.match(/^#O.*/gm)||[""])[0];return e&&(e=e.substr(2).trim()),this.author=e,this}parseComments(){var e=this.raw.match(/^#C.*|^#c.*/gm)||[];return e=e.map(e=>e.substr(2).trim()),this.comments=e,this}parseHeaderLine(){var e=this.raw.toLowerCase();return(e=((e=e.match(/x\s?=\s?\d*\s?,\s?y\s?=\s?\d*.*/gm))||[""])[0])?(e.split(",").map(e=>e.trim()).forEach(e=>{var t=e.split("=")[1].trim();"x"===e.substr(0,1)?this.width=parseInt(t):"y"===e.substr(0,1)?this.height=parseInt(t):"r"===e.substr(0,1)&&(this.ruleStr=t)}),this):this}parseCellData(){var e=[],t=[];return((this.raw.match(/^[\dbo\$]*!?$/gm)||[]).filter(e=>!!e).join("").match(/\d*b|\d*o|\d*\$/gm)||[]).forEach(r=>{for(var i=r.substr(-1),s=parseInt((r.match(/\d*/g)||[]).filter(e=>!!e)[0]||1);s--;)"$"==i?(e.push(t),t=[]):t.push("o"==i?1:0)}),t.length&&e.push(t),this.rows=e,this}stringChunker(e,t=70){var r,i,s,h,n,o=[],l=[];for(e=Array.isArray(e)?e:[e],r=0;r<e.length;r++)for(n=e[r].split(/\n/g),i=0;i<n.length;i++)n[i]&&l.push(n[i]);for(r=0;r<l.length;r++)for(s=0,h=l[r].length;s<h;s+=t)o.push(l[r].substring(s,s+t));return o}}class GoLRenderer{constructor(e){e||(e={}),this.boxSize=+e.boxSize||10,this.gridColor=e.gridColor||"#BFBFBF",this.aliveColor=e.aliveColor||"#000000",this.deadColor=e.deadColor||"#FFFFFF",this.ele=null,this.renderingArea=null,this.columns=0,this.rows=0,this.type=""}reset(){return this}render(e){return this}renderCell(e){return this}setRenderingArea(e){return this.renderingArea=e,this}isInBounds(e){return e.col*this.boxSize>=this.renderingArea.left&&e.col*this.boxSize<=this.renderingArea.right&&e.row*this.boxSize>=this.renderingArea.top&&e.row*this.boxSize<=this.renderingArea.bottom}isCoordsInBounds(e,t){return e>=this.renderingArea.left&&e<=this.renderingArea.right&&t>=this.renderingArea.top&&t<=this.renderingArea.bottom}}class GoLCanvasRenderer extends GoLRenderer{constructor(e,t){super(t),this.ele=e,this.ctx=e.getContext("2d"),this.columns=Math.floor(this.ele.width/this.boxSize),this.rows=Math.floor(this.ele.height/this.boxSize),this.renderingArea=new DOMRect(0,0,this.ele.width,this.ele.height),this.renderTimeout=!1,this.type="canvas"}renderGridLines(){this.ctx.lineWidth=1,this.ctx.strokeStyle=this.gridColor;for(var e=Math.ceil(this.renderingArea.x/this.boxSize);e*this.boxSize<=this.renderingArea.right;)this.ctx.beginPath(),this.ctx.moveTo(e*this.boxSize,this.renderingArea.top),this.ctx.lineTo(e*this.boxSize,this.renderingArea.bottom),this.ctx.stroke(),e++;for(var t=Math.ceil(this.renderingArea.y/this.boxSize);t*this.boxSize<=this.renderingArea.bottom;)this.ctx.beginPath(),this.ctx.moveTo(this.renderingArea.left,t*this.boxSize),this.ctx.lineTo(this.renderingArea.right,t*this.boxSize),this.ctx.stroke(),t++;return this}render(e){this.ctx.fillStyle=this.deadColor,this.ctx.fillRect(this.renderingArea.x,this.renderingArea.y,this.renderingArea.width,this.renderingArea.height);for(var t=e.length;t--;)this.isInBounds(e[t])&&this.renderCell(e[t]);return this.renderGridLines(),this}renderCell(e){return this.ctx.fillStyle=e.alive?this.aliveColor:this.deadColor,this.ctx.fillRect(e.col*this.boxSize+.5,e.row*this.boxSize+.5,this.boxSize-1,this.boxSize-1),this}}class GoLSVGRenderer extends GoLRenderer{constructor(e,t){super(t),this.ele=e,this.columns=Math.floor(this.ele.getAttribute("width")/this.boxSize),this.rows=Math.floor(this.ele.getAttribute("height")/this.boxSize),this.renderingArea=new DOMRect(0,0,parseInt(this.ele.getAttribute("width")),parseInt(this.ele.getAttribute("height"))),this.renderTimeout=!1,this.renderGridLines(),this.type="svg"}reset(){for(;this.ele.lastChild;)this.ele.removeChild(this.ele.lastChild);return this.renderGridLines()}renderGridLines(){var e,t,r,i;for((t=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("width",this.ele.getAttribute("width")),t.setAttribute("height",this.ele.getAttribute("height")),t.setAttribute("fill",this.deadColor),t.setAttribute("id","canvas_background"),this.ele.appendChild(t),r=0;r*this.boxSize<=parseInt(this.ele.getAttribute("width"));)(e=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("x1",r*this.boxSize),e.setAttribute("x2",r*this.boxSize),e.setAttribute("y1",0),e.setAttribute("y2",this.ele.getAttribute("height")),e.setAttribute("stroke-width",1),e.setAttribute("stroke",this.gridColor),this.ele.appendChild(e),r++;for(i=0;i*this.boxSize<=parseInt(this.ele.getAttribute("height"));)(e=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("x1",0),e.setAttribute("x2",this.ele.getAttribute("width")),e.setAttribute("y1",i*this.boxSize),e.setAttribute("y2",i*this.boxSize),e.setAttribute("stroke-width",1),e.setAttribute("stroke",this.gridColor),this.ele.appendChild(e),i++;return(t=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("width",this.ele.getAttribute("width")),t.setAttribute("height",this.ele.getAttribute("height")),t.setAttribute("fill","transparent"),t.setAttribute("id","canvas_widsheild"),this.ele.appendChild(t),this}render(e){Array.from(this.ele.getElementsByTagName("rect")).forEach(e=>{~["canvas_widsheild","canvas_background"].indexOf(e.getAttribute("id"))||this.isCoordsInBounds(parseInt(e.getAttribute("x")),parseInt(e.getAttribute("y")))&&this.ele.removeChild(e)});for(var t=e.length;t--;)this.isInBounds(e[t])&&this.renderCell(e[t]);return this}renderCell(e){if(e.alive){var t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",e.col*this.boxSize+.5),t.setAttribute("y",e.row*this.boxSize+.5),t.setAttribute("width",this.boxSize-1),t.setAttribute("height",this.boxSize-1),t.setAttribute("fill",this.aliveColor),t.setAttribute("id",e.name),this.ele.insertBefore(t,document.getElementById("canvas_widsheild"))}else try{this.ele.removeChild(document.getElementById(e.name))}catch(e){}return this}}